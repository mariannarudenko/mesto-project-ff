(()=>{"use strict";var t="https://nomoreparties.co/v1",e="82365ee2-2b03-4795-adca-78c4dec38143",n="wff-cohort-22",o={authorization:e,"Content-Type":"application/json"},r="users/me",a="cards",c="likes",u=function(t){return t.ok?t.json():Promise.reject("Что-то пошло не так:"+t.status)},i=function(o){return fetch("".concat(t,"/").concat(n,"/").concat(o),{headers:{authorization:e}}).then(u)},l=function(e,r){return fetch("".concat(t,"/").concat(n,"/").concat(e),{method:"PATCH",headers:o,body:JSON.stringify(r)}).then(u)},p=function(e){return fetch("".concat(t,"/").concat(n,"/").concat(e),{method:"DELETE",headers:o}).then(u)},d="click";function s(t,e,n,o,r,a){var c,u=(c=t.cardTemplate,document.querySelector(c).content.querySelector(".places__item").cloneNode(!0)),i=u.querySelector(t.cardImage),l=u.querySelector(t.cardTitle),p=u.querySelector(t.deleteCardButton),s=u.querySelector(t.likeCardButton),f=u.querySelector(t.likeCountElement);return function(t,e,n){t.src=n.link,t.alt=n.name,e.textContent=n.name}(i,l,e),function(t,e){t.style.display=e?"block":"none"}(p,e.owner._id===n),function(t,e){t.textContent=e}(f,e.likes.length),function(t,e,n){var o=e.likes.some((function(t){return t._id===n}));t.classList.toggle("card__like-button_is-active",o)}(s,e,n),function(t,e,n,o,r,a,c,u){e.addEventListener(d,(function(){a(r._id,t)})),n.addEventListener(d,(function(){c(r._id,t)})),o.addEventListener(d,(function(){u(r)}),{once:!0})}(u,p,s,i,e,o,r,a),u}var f="popup_is-opened",m="Escape",v="click",y="keydown",_=null;function h(t){t.classList.add(f),_=t,document.addEventListener(y,g),t.addEventListener(v,C)}function S(t){t.classList.remove(f),_=null,document.removeEventListener(y,g),t.removeEventListener(v,C)}function g(t){t.key===m&&_&&S(_)}function C(t){t.target.classList.contains(f)&&S(t.target)}function q(t,e){t.style.backgroundImage="url(".concat(e.avatar,")")}function b(t,e,n){t.textContent=n.name,e.textContent=n.about}function k(t,e,n){t.textContent=e,t.classList.add(n.errorClass)}function E(t,e){var n=t.querySelector(e.submitButtonSelector),o=t.checkValidity();n.disabled=!o,n.classList.toggle(e.inactiveButtonClass,!o)}function L(t,e){t.textContent="",t.classList.remove(e.errorClass)}function A(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){L(t.querySelector(".".concat(n.name,"-input-error")),e)})),E(t,e)}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=Array(e);n<e;n++)o[n]=t[n];return o}var B,x={cardContainer:".places__list",cardTemplate:"#card-template",cardImage:".card__image",cardTitle:".card__title",deleteCardButton:".card__delete-button",likeCountElement:".card__like-count",likeCardButton:".card__like-button",popupTypeImage:".popup_type_image",imagePopup:".popup__image",captionPopup:".popup__caption",popupCloseButton:".popup__close",popupEditProfile:".popup_type_edit",popupAddCard:".popup_type_new-card",popupDeleteCard:".popup_type_card-delete",nameInput:".popup__input_type_name",jobInput:".popup__input_type_description",placeNameInput:"input[name='place-name']",linkInput:"input[name='link']",popupChangeAvatar:".popup_type_new-avatar",avatarInput:"input[name='avatar-link']",editAvatarButton:".profile__image-edit-button",profileAvatar:".profile__image",profileName:".profile__title",profileDescription:".profile__description",editProfileButton:".profile__edit-button",addCardButton:".profile__add-button",avatarForm:"form[name='new-avatar']",profileForm:"form[name='edit-profile']",cardForm:"form[name='new-place']"},w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input-error",errorClass:"popup__input-error_active"};B=w,document.querySelectorAll(B.formSelector).forEach((function(t){t.addEventListener("input",(function(e){var n=e.target;n.matches(B.inputSelector)&&(function(t,e,n){var o=e.querySelector(".".concat(t.name,"-input-error"));"url"!==t.type||t.validity.valid?t.validity.patternMismatch?k(o,t.dataset.errorMessage,n):t.validity.valid?L(o,n):k(o,t.validationMessage,n):k(o,"Введите адрес сайта.",n),E(e,n)}(n,t,B),E(t,B))})),E(t,B)}));var P,T=document.querySelector(x.cardContainer),j=document.querySelector(x.popupTypeImage),D=j.querySelector(x.imagePopup),N=j.querySelector(x.captionPopup),F=document.querySelectorAll(x.popupCloseButton),O=document.querySelector(x.popupEditProfile),M=document.querySelector(x.popupAddCard),U=document.querySelector(x.popupDeleteCard),z=document.querySelector(x.nameInput),J=document.querySelector(x.jobInput),R=document.querySelector(x.placeNameInput),H=document.querySelector(x.linkInput),V=document.querySelector(x.popupChangeAvatar),$=document.querySelector(x.avatarInput),G=document.querySelector(x.editAvatarButton),K=document.querySelector(x.profileAvatar),Q=document.querySelector(x.profileName),W=document.querySelector(x.profileDescription),X=document.querySelector(x.editProfileButton),Y=document.querySelector(x.addCardButton),Z=document.querySelector(x.avatarForm),tt=document.querySelector(x.profileForm),et=document.querySelector(x.cardForm),nt="click",ot="submit";function rt(t){var e=t.querySelector(".popup__button");P=e.textContent,e.textContent="Сохранение...",e.disabled=!0}function at(t){var e=t.querySelector(".popup__button");e.textContent=P,e.disabled=!1}function ct(t,e){D.src=e,D.alt=t,N.textContent=t,h(j)}!function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e.forEach((function(t){return t.classList.add("popup_is-animated")}))}(V,j,O,M);var ut=function(t){console.error("Ошибка:"+t)};function it(e,r){var i=r.querySelector(x.likeCardButton),l=r.querySelector(x.likeCountElement),d="card__like-button_is-active",s=function(t,e){i.classList.toggle(d,t),l.textContent=e};i.classList.contains(d)?function(t){return p("".concat(a,"/").concat(c,"/").concat(t))}(e).then((function(t){s(!1,t.likes.length)})).catch((function(t){ut(t),s(i.classList.contains(d),l.textContent)})):function(e){return r="".concat(a,"/").concat(c,"/").concat(e),fetch("".concat(t,"/").concat(n,"/").concat(r),{method:"PUT",headers:o}).then(u);var r}(e).then((function(t){s(!0,t.likes.length)})).catch((function(t){ut(t),s(i.classList.contains(d),l.textContent)}))}var lt,pt=null,dt=null;function st(t,e){pt=t,dt=e,h(U)}function ft(t){return t.replace(/ё/g,"е").replace(/Ё/g,"Е")}U.querySelector(".popup__button").addEventListener(nt,(function(){var t;pt&&dt&&(rt(U),(t=pt,p("".concat(a,"/").concat(t))).then((function(){dt.remove(),S(U)})).catch(ut).finally((function(){at(U)})))})),G.addEventListener(nt,(function(){$.value="",A(Z,w),h(V)})),X.addEventListener(nt,(function(){z.value=Q.textContent,J.value=W.textContent,A(tt,w),h(O)})),Y.addEventListener(nt,(function(){R.value="",H.value="",A(et,w),h(M)})),Z.addEventListener(ot,(function(t){!function(t){var e;t.preventDefault(),rt(V),(e={avatar:$.value},l("users/me/avatar",e)).then((function(e){q(K,e),S(V),t.target.reset()})).catch(ut).finally((function(){at(V)}))}(t)})),tt.addEventListener(ot,(function(t){!function(t,e){var n,o;t.preventDefault(),rt(O),(n=e(z.value),o=e(J.value),l(r,{name:n,about:o})).then((function(e){b(Q,W,e),S(O),t.target.reset()})).catch(ut).finally((function(){at(O)}))}(t,ft)})),et.addEventListener(ot,(function(e){!function(e,r){e.preventDefault(),rt(M);var c,i,l,p,d={name:r(R.value),link:r(H.value)};(c=d.name,i=d.link,l=a,p={name:c,link:i},fetch("".concat(t,"/").concat(n,"/").concat(l),{method:"POST",headers:o,body:JSON.stringify(p)}).then(u)).then((function(t){var n=s(x,t,lt,(function(){return st(t._id,n)}),(function(){return it(t._id,n)}),(function(){return ct(t.name,t.link)}));T.prepend(n),S(M),e.target.reset()})).catch(ut).finally((function(){at(M)}))}(e,ft)})),F.forEach((function(t){t.addEventListener(nt,(function(){S(document.querySelector(".popup_is-opened"))}))})),Promise.all([i(r),i(a)]).then((function(t){var e,n,o=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,a,c,u=[],i=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=a.call(n)).done)&&(u.push(o.value),u.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return u}}(e,n)||function(t,e){if(t){if("string"==typeof t)return I(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],a=o[1];lt=r._id,q(K,r),b(Q,W,r),a.forEach((function(t){if(function(t){var e,n,o=t.name,r=t.link;return!(!o||!r)&&!!function(t){try{return new URL(t),!0}catch(t){return!1}}(r)&&(e=new URL(r).pathname,n=e.split(".").pop().toLowerCase(),["jpg","jpeg","png","gif","webp"].includes(n))}(t)){var e=s(x,t,lt,(function(){return st(t._id,e)}),(function(){return it(t._id,e)}),(function(){return ct(t.name,t.link)}));T.append(e)}}))})).catch(ut)})();